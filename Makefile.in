#	MMDF Root Makefile
#
#
MMDF_MAJOR_VERSION  = @MMDF_MAJOR_VERSION@
MMDF_MINOR_VERSION  = @MMDF_MINOR_VERSION@

SHELL           = /bin/sh

BUILD_SUBDIRS	= @CONFIG_SUBDIRS@
SUBDIR		= @SUBDIRS@

install_prefix	=
prefix		= @prefix@
exec_prefix	= @exec_prefix@
libdir		= @libdir@
libexecdir	= @libexecdir@
bindir		= @bindir@
sbindir		= @sbindir@
rcvdir		= @rcvdir@
datadir		= @datadir@
sharedstatedir	= @sharedstatedir@
localstatedir	= @localstatedir@
mmdfprefix	= @mmdfprefix@
mmdflibdir	= @mmdflibdir@
chandir		= @chandir@
tbldir		= @tbldir@
sysconfdir	= @sysconfdir@
srcdir          = @srcdir@
varprefix       = @varprefix@
mmdflogdir      = @mmdflogdir@
mmdfphasedir    = @mmdfphasedir@
mmdfspooldir    = @mmdfspooldir@
mmdfdiallog	= @mmdfdiallog@
PATHNAMES	= h/pathnames.h

HOST		= @HOST@
HOST		= @host@
HOST_CPU	= @host_cpu@
HOST_VENDOR	= @host_vendor@
HOST_OS		= @host_os@
HOST_ALIAS	= @host_alias@
SYSTEM		= @SYSTEM@
SYSTEM		= @system@

## 
## various programs
##
CC              = @CC@
CXX             = @CXX@
INSTALL         = ./install-sh -c
INSTALL_PROGRAM = ${INSTALL}
CHOWN		= @CHOWN@
MMDFLOGIN	= @MMDFLOGIN@
ROOTLOGIN	= @ROOTLOGIN@
PGMPROT		= @PGMPROT@
DIALPROG	= @DIAL@

##
## compiler and linker options
##
CFLAGS          = @CFLAGS@
CPPFLAGS        = -I${srcdir} @CPPFLAGS@ 
DEFS            = @DEFS@ -DNDEBUG
LDFLAGS         = @LDFLAGS@
STATIC_LDFLAGS  = @STATIC_LDFLAGS@
LIBS            = @NEED_LIBS@
MMDFLIBS	= @MMDFLIBS@

all: pathnames binary

binary: pathnames
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make ${MFLAGS} ${MAKEFLAGS}); done

depend:
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make ${MFLAGS} ${MAKEFLAGS} depend); done

lint:
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make ${MFLAGS} ${MAKEFLAGS} lint); done

install: dirs
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make ${MFLAGS} ${MAKEFLAGS} install); done

clean:
	rm -f make.out ${PATHNAMES}
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make $@); done

distclean:
	rm -f make.out ${PATHNAMES}
	for dir in ${SUBDIR}; do \
		(cd $${dir}; make $@); done
	rm -f config.cache config.log config.status
	rm -f TAGS* *.gz *.tar h/config.h *~ #*#
	(cd conf; ./cleanup )
	rm -f Makefile.com conf/common/Makefile.com
	rm -f Makefile

########################
#
pathnames: ${PATHNAMES}

${PATHNAMES}: Makefile
	-@echo "creating ${PATHNAMES}"
	-@echo "/*"  > ${PATHNAMES}
	-@echo " * pathnames.h:  created by Makefile" >> ${PATHNAMES}
	-@echo " */" >> ${PATHNAMES}
	-@echo >> ${PATHNAMES}
	-@echo "#define PREFIX      \"${prefix}\"" >> ${PATHNAMES}
	-@echo "#define BINDIR      \"${bindir}\"" >> ${PATHNAMES}
	-@echo "#define SBINDIR     \"${sbindir}\"" >> ${PATHNAMES}
	-@echo "#define LIBEXECDIR  \"${libexecdir}\"" >> ${PATHNAMES}
	-@echo >> ${PATHNAMES}
	-@echo "#define MMDFPREFIX   \"${mmdfprefix}\"" >> ${PATHNAMES}
	-@echo "#define MMDFLIBDIR   \"${mmdflibdir}\"" >> ${PATHNAMES}
	-@echo "#define MMDFCHANDIR  \"${chandir}\"" >> ${PATHNAMES}
	-@echo "#define MMDFTABLEDIR \"${tbldir}\"" >> ${PATHNAMES}
	-@echo "#define MMDFCFGDIR   \"${sysconfdir}\"" >> ${PATHNAMES}
	-@echo >> ${PATHNAMES}
	-@echo "#define MMDFPSOOLDIR \"${mmdfspooldir}\"" >> ${PATHNAMES}
	-@echo "#define MMDFLOGDIR   \"${mmdflogdir}\"" >> ${PATHNAMES}
	-@echo "#define MM_PHASEDIR  \"${mmdfphasedir}\"" >> ${PATHNAMES}
	-@echo >> ${PATHNAMES}
	-@echo "#define MM_MMDFTAILOR \"${sysconfdir}/mmdftailor\"" >> ${PATHNAMES}
	-@echo "#define MM_TBLDBM    \"${tbldir}/mmdfdbm\"" >> ${PATHNAMES}
	-@echo "#define MM_AUTHFILE  \"${sysconfdir}/warning\"" >> ${PATHNAMES}
	-@echo "#define MM_DIALLOG   \"${mmdfdiallog}\"" >> ${PATHNAMES}
	-@echo "#define RESENDPROG   \"|${bindir}/resend \"" >> ${PATHNAMES}
	-@echo "#define SENDPROG     \"${bindir}/send\"" >> ${PATHNAMES}
	-@echo "#define DIALPROG     \"${DIALPROG}\"" >> ${PATHNAMES}

########################
#
dirs:
	-if test ! -x ${install_prefix}${prefix}; then \
		mkdir -p ${install_prefix}${prefix}; \
		chmod 755 ${install_prefix}${prefix}; \
	fi
	-if test ! -x ${install_prefix}/usr/lib; then \
		mkdir -p ${install_prefix}/usr/lib; fi
	-if test ! -x ${install_prefix}${bindir}; then \
		mkdir -p ${install_prefix}${bindir}; fi
	-if test ! -x ${install_prefix}${sbindir}; then \
		mkdir -p ${install_prefix}${sbindir}; fi
	-if test ! -x ${install_prefix}${libexecdir}; then \
		mkdir -p ${install_prefix}${libexecdir}; fi
	-if test ! -x ${install_prefix}${mmdfspooldir}; then \
		mkdir -p ${install_prefix}${mmdfspooldir}; fi
	-if test ! -x ${install_prefix}${mmdflogdir}; then \
		mkdir -p ${install_prefix}${mmdflogdir}; fi
	-if test ! -x ${install_prefix}${mmdfphasedir}; then \
		mkdir -p ${install_prefix}${mmdfphasedir}; fi
#	-if test ! -x ${install_prefix}${sharedstatedir}; then mkdir -p ${install_prefix}${sharedstatedir}; fi
#	-if test ! -x ${install_prefix}${localstatedir}; then mkdir -p ${install_prefix}${localstatedir}; fi
	-if test ! -x ${install_prefix}${mmdfprefix}; then \
		mkdir -p ${install_prefix}${mmdfprefix}; fi
	-if test ! -x ${install_prefix}${mmdflibdir}; then \
		mkdir -p ${install_prefix}${mmdflibdir}; fi
	-if test ! -x ${install_prefix}${chandir}; then \
		mkdir -p ${install_prefix}${chandir}; fi
	-if test ! -x ${install_prefix}${tbldir}; then \
		mkdir -p ${install_prefix}${tbldir}; fi
	-if test ! -x ${install_prefix}${sysconfdir}; then \
		mkdir -p ${install_prefix}${sysconfdir}; fi
	-if test ! -x ${install_prefix}${rcvdir}; then \
		mkdir -p ${install_prefix}${rcvdir}; fi

########################
#
${srcdir}/configure:    configure.in
	cd ${srcdir} && autoconf -m ${srcdir}/autoconf

# autoheader might not change config.h.in, so touch a stamp file.
${srcdir}/config.h.in:  stamp-h.in
${srcdir}/stamp-h.in:   configure.in conf-site.h
	cd ${srcdir} && autoheader
	echo timestamp > ${srcdir}/stamp-h.in

config.h:       stamp-h
stamp-h:        config.h.in config.status
	./config.status

Makefile:       Makefile.in config.status
	./config.status

config.status: configure
	./config.status --recheck

########################
#
TAGS:
	etags lib/*/*.[ch] src/*/*.[ch] uip/*/*.[ch] h/*.[ch]

